---
title: "Extraction d'indices Sentinel-2"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Extraction d'indices Sentinel-2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(rgeoag)
library(sf)
library(ggplot2)
library(terra)
```

## ğŸ›°ï¸ Introduction

Lâ€™imagerie Sentinel-2 offre une rÃ©solution spatiale et temporelle prÃ©cieuse pour le suivi de la santÃ© des cultures. Cette vignette montre comment extraire automatiquement un **indice de vÃ©gÃ©tation NDVI** pour un champ, Ã  partir de la plateforme Planetary Computer.

Nous illustrons ici une extraction du NDVI pour **lâ€™Ã©tÃ© 2024 (juin Ã  aoÃ»t)**, avec un seuil de couverture nuageuse.

---

## ğŸ“¥ Chargement du champ d'exemple

```{r}
champ <- champs_exemple |> dplyr::slice(1) |> sf::st_sf() |> st_utm()
plot(st_geometry(champ))
```

---

## ğŸ“¡ RÃ©cupÃ©ration du NDVI Sentinel-2 (Ã©tÃ© 2024)

```{r}
ndvi <- sentinel2(
  polygone = champ,
  annee_debut = 2024,
  annee_fin = 2024,
  mois = 6:8,
  indice = "NDVI",
  max_nuage = 20
)
```

---

## ğŸ–¼ï¸ Visualisation du NDVI

```{r}
plot(ndvi)
```

---

## ğŸ’¡ Remarques

- La fonction `sentinel2()` interroge directement les catalogues STAC du **Planetary Computer de Microsoft**.
- Les images sont filtrÃ©es selon la **proportion de nuages** dans la parcelle.
- L'utilisateur peut aussi choisir d'autres indices (`GNDVI`, `EVI`, `KNDVI`).

---

Cette approche facilite lâ€™analyse temporelle automatisÃ©e pour des parcelles multiples dans un contexte de **monitoring de cultures** ou de **diagnostic de stress hydrique ou nutritionnel**.

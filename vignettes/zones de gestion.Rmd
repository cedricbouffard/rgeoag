---
title: "CrÃ©ation de zones de gestion"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Exemple : CrÃ©ation de zones de gestion}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
library(rgeoag)
library(sf)
library(ggplot2)
library(terra)
```

## ğŸŒ¾ Pourquoi crÃ©er des zones de gestion?

La crÃ©ation de zones de gestion permet dâ€™adapter les pratiques agricoles (fertilisation, semis, irrigation, etc.) aux caractÃ©ristiques spatiales dâ€™un champ. Cela favorise une meilleure utilisation des intrants, une augmentation des rendements et une rÃ©duction des impacts environnementaux.

### ğŸ” ContinuitÃ© spatiale

Dans notre approche, **nous favorisons la crÃ©ation de zones spatialement contiguÃ«s**. Cela facilite la mise en Å“uvre pratique sur le terrain (ex. : prescriptions machines), rÃ©duit les transitions abruptes et reflÃ¨te mieux la structure naturelle du sol et des cultures.

---

## ğŸ“¥ Chargement des donnÃ©es d'exemple

```{r}
# Charger un exemple de champ inclus dans le package
champ <- champs_exemple |> 
  dplyr::slice(1) |>
  sf::st_sf() |> 
  st_utm() 
plot(st_geometry(champ))
```

---

## ğŸ“¡ RÃ©cupÃ©ration des donnÃ©es LiDAR

```{r}
# TÃ©lÃ©charger automatiquement le LiDAR le plus rÃ©cent
r_lidar <- lidar(champ, recent = TRUE)[[1]]
```

---

## ğŸ›°ï¸ NDVI Sentinel-2 pour l'Ã©tÃ© 2024

```{r}
# Extraction du NDVI (juin Ã  aoÃ»t 2024)
ndvi <- sentinel2(champ, annee_debut = 2024, annee_fin = 2024, mois = 6:8, indice = "NDVI", max_nuage = 50)
```

---

## ğŸ§ª CrÃ©ation des zones de gestion

```{r}
# SÃ©lectionner les couches utiles
raster_liste <- list(ndvi, r_lidar)

# PrÃ©paration des superpixels
zones_prepa <- preparation_zones(raster_liste, k_supercell = 300)
s_poly <- zones_prepa$s_polygone
poids <- zones_prepa$poids
df <- zones_prepa$donnees
```

---

## ğŸ§© Regroupement avec SKATER

```{r}
zones_sf <- zones(s_poly, w = poids, df = df, n_zones = 4, superficie_min = 10000)
```

---

## ğŸ–¼ï¸ Visualisation

```{r}
ggplot(zones_sf) +
  geom_sf(aes(fill = factor(cl)), color = "white") +
  scale_fill_brewer(palette = "Set3") +
  theme_minimal() +
  labs(title = "Zones de gestion spatiales", fill = "Zone")
```

---

Ce processus peut Ãªtre automatisÃ© pour plusieurs champs, intÃ©grÃ© Ã  une interface Shiny ou combinÃ© avec des recommandations dâ€™intrants.
